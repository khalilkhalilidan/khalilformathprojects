<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø¯ÙˆØ§Ù„, Ø¥Ø¹Ø¯Ø§Ø¯: Ø®Ù„ÙŠÙ„ Ø®Ù„ÙŠÙ„</title>
    <script>
        MathJax = {
            tex: { inlineMath: [['\\(', '\\)']], displayMath: [['\\[', '\\]']] },
            options: { skipHtmlTags: ['script', 'style'] }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(160deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            min-height: 100vh;
            direction: rtl;
            color: #e0e0e0;
        }

        .container { max-width: 850px; margin: 0 auto; padding: 20px; }

        .header {
            text-align: center;
            padding: 45px 20px 35px;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(90deg, transparent, #a78bfa, transparent);
        }

        .header h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #a78bfa, #60a5fa, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p { color: #94a3b8; font-size: 1.1em; }

        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.6s ease; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(25px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(167,139,250,0.4); }
            50% { transform: scale(1.03); box-shadow: 0 0 25px 5px rgba(167,139,250,0.2); }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.9); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%,100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        /* ===== START SCREEN ===== */
        .start-card {
            background: rgba(30, 27, 75, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167,139,250,0.2);
            border-radius: 24px;
            padding: 50px 40px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .start-card h2 {
            font-size: 1.8em;
            color: #e2e8f0;
            margin-bottom: 15px;
        }

        .start-card > p { color: #94a3b8; font-size: 1.05em; line-height: 1.7; }

        .info-grid {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 35px 0;
            flex-wrap: wrap;
        }

        .info-box {
            background: rgba(167,139,250,0.1);
            border: 1px solid rgba(167,139,250,0.2);
            padding: 20px 30px;
            border-radius: 16px;
            min-width: 130px;
            transition: transform 0.3s, border-color 0.3s;
        }

        .info-box:hover {
            transform: translateY(-4px);
            border-color: rgba(167,139,250,0.5);
        }

        .info-box .num {
            font-size: 2.2em;
            font-weight: 700;
            background: linear-gradient(135deg, #a78bfa, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .info-box .lbl { font-size: 0.9em; color: #94a3b8; margin-top: 5px; }

        .start-btn {
            background: linear-gradient(135deg, #7c3aed, #6366f1, #3b82f6);
            color: #fff;
            border: none;
            padding: 16px 55px;
            font-size: 1.25em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            animation: pulse 2.5s infinite;
            margin-top: 10px;
        }

        .start-btn:hover {
            box-shadow: 0 8px 30px rgba(124,58,237,0.5);
            transform: translateY(-3px);
        }

        /* ===== PROGRESS ===== */
        .progress-section { margin-bottom: 24px; }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95em;
            color: #94a3b8;
        }

        .progress-track {
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(90deg, #7c3aed, #3b82f6, #34d399);
            transition: width 0.6s ease;
        }

        /* ===== QUESTION CARD ===== */
        .q-card {
            background: rgba(30, 27, 75, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167,139,250,0.15);
            border-radius: 24px;
            padding: 35px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
        }

        .q-badge {
            display: inline-block;
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
            padding: 6px 18px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 18px;
        }

        .q-text {
            font-size: 1.2em;
            line-height: 2;
            padding: 18px 22px;
            background: rgba(255,255,255,0.04);
            border-radius: 14px;
            border-right: 4px solid #7c3aed;
            margin-bottom: 28px;
            color: #e2e8f0;
        }

        /* ===== CHOICES ===== */
        .choices { display: flex; flex-direction: column; gap: 14px; margin-bottom: 22px; }

        .choice {
            display: flex;
            align-items: center;
            padding: 16px 22px;
            border: 2px solid rgba(255,255,255,0.08);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.03);
        }

        .choice:hover:not(.disabled) {
            border-color: rgba(167,139,250,0.5);
            background: rgba(167,139,250,0.08);
        }

        .choice.selected {
            border-color: #a78bfa;
            background: rgba(167,139,250,0.12);
        }

        .choice.correct {
            border-color: #34d399 !important;
            background: rgba(52,211,153,0.12) !important;
            animation: bounceIn 0.4s ease;
        }

        .choice.wrong {
            border-color: #f87171 !important;
            background: rgba(248,113,113,0.12) !important;
            animation: shake 0.4s ease;
        }

        .choice.disabled { cursor: default; }

        .choice-lbl {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background: rgba(255,255,255,0.06);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 16px;
            font-weight: 700;
            color: #94a3b8;
            flex-shrink: 0;
            transition: all 0.3s;
            font-size: 0.95em;
        }

        .choice.selected .choice-lbl { background: #7c3aed; color: #fff; }
        .choice.correct .choice-lbl { background: #059669; color: #fff; }
        .choice.wrong .choice-lbl { background: #dc2626; color: #fff; }

        .choice-math { flex: 1; font-size: 1.1em; color: #e2e8f0; }
        .choice-icon { margin-right: auto; margin-left: 8px; font-size: 1.3em; }

        /* ===== HINT ===== */
        .hint-area { margin-bottom: 18px; }

        .hint-btn {
            background: rgba(251,191,36,0.12);
            border: 1px solid rgba(251,191,36,0.3);
            padding: 10px 28px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            color: #fbbf24;
            transition: all 0.3s;
            font-family: inherit;
        }

        .hint-btn:hover {
            background: rgba(251,191,36,0.2);
            transform: translateY(-2px);
        }

        .hint-box {
            display: none;
            background: rgba(251,191,36,0.06);
            border: 1px solid rgba(251,191,36,0.2);
            border-radius: 14px;
            padding: 16px 22px;
            margin-top: 12px;
            font-size: 1em;
            line-height: 2;
            color: #fde68a;
            animation: slideUp 0.3s ease;
        }

        .hint-box.show { display: block; }

        /* ===== FEEDBACK ===== */
        .feedback-msg {
            padding: 16px 22px;
            border-radius: 14px;
            margin-top: 16px;
            font-size: 1.1em;
            display: none;
            animation: slideUp 0.3s ease;
        }

        .feedback-msg.show { display: block; }

        .feedback-msg.fb-correct {
            background: rgba(52,211,153,0.1);
            color: #34d399;
            border: 1px solid rgba(52,211,153,0.3);
        }

        .feedback-msg.fb-wrong {
            background: rgba(248,113,113,0.1);
            color: #f87171;
            border: 1px solid rgba(248,113,113,0.3);
        }

        /* ===== BUTTONS ===== */
        .btn-row {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 22px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 13px 38px;
            border: none;
            border-radius: 30px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-check {
            background: linear-gradient(135deg, #7c3aed, #6366f1);
            color: #fff;
        }

        .btn-check:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(124,58,237,0.4);
        }

        .btn-check:disabled { background: #4b5563; color: #9ca3af; cursor: not-allowed; }

        .btn-next {
            background: linear-gradient(135deg, #059669, #0d9488);
            color: #fff;
            display: none;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(5,150,105,0.4);
        }

        .btn-next.show { display: inline-block; }

        /* ===== RESULTS ===== */
        .results-card {
            background: rgba(30, 27, 75, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(167,139,250,0.15);
            border-radius: 24px;
            padding: 45px 35px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .results-card h2 { font-size: 1.8em; color: #e2e8f0; margin-bottom: 30px; }

        .donut {
            width: 210px;
            height: 210px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            position: relative;
        }

        .donut-inner {
            width: 170px;
            height: 170px;
            border-radius: 50%;
            background: rgba(30,27,75,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .donut-pct {
            font-size: 2.8em;
            font-weight: 700;
            background: linear-gradient(135deg, #a78bfa, #60a5fa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .donut-label { font-size: 0.9em; color: #94a3b8; }

        .result-msg {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: #e2e8f0;
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .stat-box {
            padding: 22px 32px;
            border-radius: 16px;
            min-width: 140px;
        }

        .stat-ok {
            background: rgba(52,211,153,0.1);
            border: 2px solid rgba(52,211,153,0.3);
        }

        .stat-fail {
            background: rgba(248,113,113,0.1);
            border: 2px solid rgba(248,113,113,0.3);
        }

        .stat-num { font-size: 2.4em; font-weight: 700; }
        .stat-ok .stat-num { color: #34d399; }
        .stat-fail .stat-num { color: #f87171; }
        .stat-txt { font-size: 0.9em; color: #94a3b8; margin-top: 4px; }

        .summary-title { color: #94a3b8; margin: 25px 0 15px; font-size: 1.1em; }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 0 auto 30px;
            max-width: 350px;
        }

        .s-item {
            width: 52px;
            height: 52px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.05em;
            margin: 0 auto;
            color: #fff;
        }

        .s-ok { background: linear-gradient(135deg, #059669, #34d399); }
        .s-fail { background: linear-gradient(135deg, #dc2626, #f87171); }

        .retry-btn {
            background: linear-gradient(135deg, #7c3aed, #6366f1, #3b82f6);
            color: #fff;
            border: none;
            padding: 16px 45px;
            font-size: 1.15em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .retry-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(124,58,237,0.5);
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 640px) {
            .header h1 { font-size: 1.6em; }
            .q-card { padding: 22px 18px; }
            .q-text { font-size: 1.05em; padding: 14px 16px; }
            .choice { padding: 13px 15px; }
            .start-card { padding: 30px 22px; }
            .results-card { padding: 30px 20px; }
            .info-box { min-width: 100px; padding: 15px 20px; }
            .btn { padding: 12px 28px; font-size: 1em; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ğŸ“ Ø§Ø®ØªØ¨Ø§Ø± ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø¯ÙˆØ§Ù„, Ø¥Ø¹Ø¯Ø§Ø¯: Ø®Ù„ÙŠÙ„ Ø®Ù„ÙŠÙ„</h1>
    <p>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø³Ù„Ø³Ù„Ø© â€” Chain Rule</p>
</div>

<div class="container">

    <!-- ====== START ====== -->
    <div id="startScreen" class="screen active">
        <div class="start-card">
            <h2>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</h2>
            <p>Ø§Ø®ØªØ¨Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ ÙÙŠ Ø¥ÙŠØ¬Ø§Ø¯ Ù…Ø´ØªÙ‚Ø© ØªØ±ÙƒÙŠØ¨ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø³Ù„Ø³Ù„Ø©</p>
            <p style="margin-top:6px;color:#7c8ba0;">
                \((f\circ g)'(x)=f'(g(x))\cdot g'(x)\)
            </p>
            <div class="info-grid">
                <div class="info-box">
                    <div class="num">15</div>
                    <div class="lbl">Ø³Ø¤Ø§Ù„</div>
                </div>
                <div class="info-box">
                    <div class="num">4</div>
                    <div class="lbl">Ø®ÙŠØ§Ø±Ø§Øª Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„</div>
                </div>
                <div class="info-box">
                    <div class="num">ğŸ’¡</div>
                    <div class="lbl">ØªÙ„Ù…ÙŠØ­Ø§Øª Ù…ØªØ§Ø­Ø©</div>
                </div>
            </div>
            <button class="start-btn" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± â–¶</button>
        </div>
    </div>

    <!-- ====== QUIZ ====== -->
    <div id="quizScreen" class="screen">
        <div class="progress-section">
            <div class="progress-info">
                <span id="pText">Ø§Ù„Ø³Ø¤Ø§Ù„ 1 Ù…Ù† 15</span>
                <span id="sText">Ø§Ù„Ù†ØªÙŠØ¬Ø©: 0</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="pBar" style="width:0%"></div>
            </div>
        </div>
        <div id="qContainer"></div>
    </div>

    <!-- ====== RESULTS ====== -->
    <div id="resultsScreen" class="screen">
        <div class="results-card" id="resultsCard"></div>
    </div>
</div>

<script>
/* ============ QUESTION DATA ============ */
const questions = [
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\ln(x)\\) Ùˆ \\(g(x)=x^4-3x^2+1\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{4x^3-6x}{x^4-3x^2+1}`,
      `\\frac{1}{x^4-3x^2+1}`,
      `(4x^3-6x)\\,\\ln(x^4-3x^2+1)`,
      `\\frac{4x^3}{x^4-3x^2+1}`
    ],
    correct: 0,
    hint: `\\(f'(x)=\\frac{1}{x}\\) Ùˆ \\(g'(x)=4x^3-6x\\)ØŒ Ù„Ø°Ø§ \\(f'(g(x))\\cdot g'(x)=\\frac{4x^3-6x}{x^4-3x^2+1}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=e^x\\) Ùˆ \\(g(x)=\\sin(x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `e^{\\sin x}\\cdot\\sin x`,
      `e^{\\cos x}\\cdot\\cos x`,
      `e^{\\sin x}\\cdot\\cos x`,
      `\\cos x\\cdot e^{\\cos x}`
    ],
    correct: 2,
    hint: `\\(f'(x)=e^x\\) Ùˆ \\(g'(x)=\\cos x\\)ØŒ Ù„Ø°Ø§ Ø§Ù„Ù†Ø§ØªØ¬ \\(e^{\\sin x}\\cdot\\cos x\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\cos(x)\\) Ùˆ \\(g(x)=\\ln(x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{\\cos(\\ln x)}{x}`,
      `\\frac{-\\sin(\\ln x)}{x}`,
      `-\\sin(\\ln x)`,
      `\\frac{-\\cos(\\ln x)}{x}`
    ],
    correct: 1,
    hint: `\\(f'(x)=-\\sin x\\) Ùˆ \\(g'(x)=\\frac{1}{x}\\)ØŒ Ù„Ø°Ø§ Ø§Ù„Ù†Ø§ØªØ¬ \\(\\frac{-\\sin(\\ln x)}{x}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=x^5\\) Ùˆ \\(g(x)=e^x\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `5e^{4x}`,
      `e^{5x}`,
      `5e^{5x}`,
      `5x\\,e^{5x}`
    ],
    correct: 2,
    hint: `\\(f'(x)=5x^4\\)ØŒ Ø¹ÙˆÙ‘Ø¶ \\(g(x)\\): \\(5(e^x)^4\\cdot e^x=5e^{4x}\\cdot e^x=5e^{5x}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\ln(x)\\) Ùˆ \\(g(x)=\\tan(x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{\\sec^2 x}{\\tan x}`,
      `\\frac{1}{\\tan x}`,
      `\\sec^2 x\\cdot\\ln(\\tan x)`,
      `\\frac{\\tan x}{\\sec^2 x}`
    ],
    correct: 0,
    hint: `\\(f'(x)=\\frac{1}{x}\\) Ùˆ \\(g'(x)=\\sec^2 x\\)ØŒ Ù„Ø°Ø§ Ø§Ù„Ù†Ø§ØªØ¬ \\(\\frac{\\sec^2 x}{\\tan x}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=e^x\\) Ùˆ \\(g(x)=\\sqrt{x^2+1}\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `e^{\\sqrt{x^2+1}}`,
      `\\frac{x\\;e^{\\sqrt{x^2+1}}}{\\sqrt{x^2+1}}`,
      `\\frac{e^{\\sqrt{x^2+1}}}{\\sqrt{x^2+1}}`,
      `\\frac{2x\\;e^{\\sqrt{x^2+1}}}{\\sqrt{x^2+1}}`
    ],
    correct: 1,
    hint: `\\(g'(x)=\\frac{x}{\\sqrt{x^2+1}}\\)ØŒ Ø§Ø¶Ø±Ø¨ ÙÙŠ \\(f'(g(x))=e^{\\sqrt{x^2+1}}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\sin(x)\\) Ùˆ \\(g(x)=e^x\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `e^x\\sin(e^x)`,
      `\\cos(e^x)`,
      `e^x\\cos(e^x)`,
      `-e^x\\cos(e^x)`
    ],
    correct: 2,
    hint: `\\(f'(x)=\\cos x\\) Ùˆ \\(g'(x)=e^x\\)ØŒ Ù„Ø°Ø§ Ø§Ù„Ù†Ø§ØªØ¬ \\(e^x\\cos(e^x)\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\sqrt[3]{x}\\) Ùˆ \\(g(x)=\\ln(x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{1}{3(\\ln x)^{2/3}}`,
      `\\frac{1}{3x\\,(\\ln x)^{2/3}}`,
      `\\frac{(\\ln x)^{1/3}}{x}`,
      `\\frac{1}{3x\\,\\sqrt[3]{\\ln x}}`
    ],
    correct: 1,
    hint: `\\(f'(x)=\\tfrac{1}{3}x^{-2/3}\\) Ùˆ \\(g'(x)=\\frac{1}{x}\\)ØŒ Ø§Ù„Ù†Ø§ØªØ¬ \\(\\frac{1}{3x(\\ln x)^{2/3}}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=e^x\\) Ùˆ \\(g(x)=2x^3-5\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `e^{2x^3-5}`,
      `6x^2\\,e^{2x^3}`,
      `2x^3\\,e^{2x^3-5}`,
      `6x^2\\,e^{2x^3-5}`
    ],
    correct: 3,
    hint: `\\(f'(x)=e^x\\) Ùˆ \\(g'(x)=6x^2\\)ØŒ Ù„Ø°Ø§ Ø§Ù„Ù†Ø§ØªØ¬ \\(6x^2\\,e^{2x^3-5}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\ln(x)\\) Ùˆ \\(g(x)=\\cos(2x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `-\\tan(2x)`,
      `-2\\tan(2x)`,
      `\\frac{-2}{\\cos(2x)}`,
      `2\\tan(2x)`
    ],
    correct: 1,
    hint: `\\(g'(x)=-2\\sin(2x)\\)ØŒ Ù„Ø°Ø§ \\(\\frac{-2\\sin(2x)}{\\cos(2x)}=-2\\tan(2x)\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\tan(x)\\) Ùˆ \\(g(x)=\\ln(x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{\\sec^2(\\ln x)}{x}`,
      `\\sec^2(\\ln x)`,
      `\\frac{\\tan(\\ln x)}{x}`,
      `\\frac{\\sec(\\ln x)\\,\\tan(\\ln x)}{x}`
    ],
    correct: 0,
    hint: `\\(f'(x)=\\sec^2 x\\) Ùˆ \\(g'(x)=\\frac{1}{x}\\)ØŒ Ø§Ù„Ù†Ø§ØªØ¬ \\(\\frac{\\sec^2(\\ln x)}{x}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\frac{1}{x}\\) Ùˆ \\(g(x)=e^{2x}\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `-2e^{-2x}`,
      `-e^{-2x}`,
      `2e^{-2x}`,
      `-2e^{2x}`
    ],
    correct: 0,
    hint: `\\(f'(x)=-\\frac{1}{x^2}\\) Ùˆ \\(g'(x)=2e^{2x}\\)ØŒ Ø¨Ø³Ù‘Ø· \\(-\\frac{2e^{2x}}{e^{4x}}=-2e^{-2x}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\ln(x)\\) Ùˆ \\(g(x)=e^x+x\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{e^x}{e^x+x}`,
      `\\frac{e^x+1}{e^x+x}`,
      `\\frac{1}{e^x+x}`,
      `\\frac{e^x+1}{e^x}`
    ],
    correct: 1,
    hint: `\\(g'(x)=e^x+1\\) Ùˆ \\(f'(g(x))=\\frac{1}{e^x+x}\\)ØŒ Ø§Ù„Ù†Ø§ØªØ¬ \\(\\frac{e^x+1}{e^x+x}\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=e^x\\) Ùˆ \\(g(x)=\\ln(x)\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `\\frac{1}{x}`,
      `\\ln(x)\\cdot e^x`,
      `1`,
      `x`
    ],
    correct: 2,
    hint: `Ù„Ø§Ø­Ø¸ Ø£Ù† \\(e^{\\ln x}=x\\)ØŒ Ø¥Ø°Ù† \\((f\\circ g)(x)=x\\) ÙˆÙ…Ø´ØªÙ‚ØªÙ‡ \\(1\\)`
  },
  {
    question: `Ù„ØªÙƒÙ† \\(f(x)=\\sin^2(x)\\) Ùˆ \\(g(x)=e^x\\). Ø£ÙˆØ¬Ø¯ \\((f\\circ g)'(x)\\)`,
    choices: [
      `2e^{2x}\\sin(e^x)\\cos(e^x)`,
      `e^x\\sin(2e^x)`,
      `e^x\\cos(2e^x)`,
      `2e^x\\sin(e^x)`
    ],
    correct: 1,
    hint: `\\(f'(x)=2\\sin x\\cos x=\\sin(2x)\\)ØŒ Ù„Ø°Ø§ Ø§Ù„Ù†Ø§ØªØ¬ \\(\\sin(2e^x)\\cdot e^x\\)`
  }
];

/* ============ STATE ============ */
let cur = 0, score = 0, sel = -1, locked = false;
const answers = [];
const labels = ['Ø£','Ø¨','Ø¬','Ø¯'];

/* ============ NAVIGATION ============ */
function show(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function startQuiz() {
    cur = 0; score = 0; answers.length = 0;
    show('quizScreen');
    render();
}

/* ============ RENDER ============ */
function render() {
    sel = -1; locked = false;
    const q = questions[cur];
    const total = questions.length;

    document.getElementById('pText').textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${cur+1} Ù…Ù† ${total}`;
    document.getElementById('sText').textContent = `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${score}`;
    document.getElementById('pBar').style.width = `${(cur/total)*100}%`;

    let h = `<div class="q-card">
        <span class="q-badge">Ø§Ù„Ø³Ø¤Ø§Ù„ ${cur+1}</span>
        <div class="q-text">${q.question}</div>
        <div class="choices">`;

    q.choices.forEach((c, i) => {
        h += `<div class="choice" id="ch${i}" onclick="pick(${i})">
            <div class="choice-lbl">${labels[i]}</div>
            <div class="choice-math">\\(\\displaystyle ${c}\\)</div>
            <div class="choice-icon" id="ic${i}"></div>
        </div>`;
    });

    h += `</div>
        <div class="hint-area">
            <button class="hint-btn" onclick="toggleHint()">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
            <div class="hint-box" id="hintBox">${q.hint}</div>
        </div>
        <div class="feedback-msg" id="fb"></div>
        <div class="btn-row">
            <button class="btn btn-check" id="btnCheck" onclick="check()">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© âœ“</button>
            <button class="btn btn-next" id="btnNext" onclick="next()">
                ${cur < total-1 ? 'Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ â†' : 'Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ğŸ“Š'}
            </button>
        </div>
    </div>`;

    document.getElementById('qContainer').innerHTML = h;
    typeset();
    window.scrollTo({top:0,behavior:'smooth'});
}

function typeset() {
    if (window.MathJax && MathJax.typesetPromise) {
        MathJax.typesetPromise().catch(()=>{});
    }
}

/* ============ INTERACTION ============ */
function pick(i) {
    if (locked) return;
    sel = i;
    document.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
    document.getElementById('ch'+i).classList.add('selected');
}

function toggleHint() {
    const box = document.getElementById('hintBox');
    box.classList.toggle('show');
    if (box.classList.contains('show')) typeset();
}

function check() {
    if (sel < 0) {
        const fb = document.getElementById('fb');
        fb.className = 'feedback-msg show fb-wrong';
        fb.textContent = 'âš ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ø£ÙˆÙ„Ø§Ù‹';
        setTimeout(()=> fb.classList.remove('show'), 2000);
        return;
    }
    if (locked) return;
    locked = true;

    const q = questions[cur];
    const ok = sel === q.correct;
    if (ok) score++;

    answers.push({ idx: cur, sel, correct: q.correct, ok });

    document.querySelectorAll('.choice').forEach((c,i) => {
        c.classList.add('disabled');
        c.classList.remove('selected');
        if (i === q.correct) {
            c.classList.add('correct');
            document.getElementById('ic'+i).textContent = 'âœ“';
        }
        if (i === sel && !ok) {
            c.classList.add('wrong');
            document.getElementById('ic'+i).textContent = 'âœ—';
        }
    });

    const fb = document.getElementById('fb');
    fb.classList.add('show');
    if (ok) {
        fb.className = 'feedback-msg show fb-correct';
        fb.textContent = 'ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! Ø£Ø­Ø³Ù†Øª!';
    } else {
        fb.className = 'feedback-msg show fb-wrong';
        fb.textContent = 'âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù…ÙˆØ¶Ø­Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø®Ø¶Ø±.';
    }

    document.getElementById('sText').textContent = `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${score}`;
    document.getElementById('btnCheck').style.display = 'none';
    document.getElementById('btnNext').classList.add('show');

    setTimeout(()=>{
        document.getElementById('fb').scrollIntoView({behavior:'smooth',block:'center'});
    }, 100);
}

function next() {
    if (cur < questions.length - 1) { cur++; render(); }
    else showResults();
}

/* ============ RESULTS ============ */
function showResults() {
    show('resultsScreen');
    const total = questions.length;
    const pct = Math.round((score/total)*100);
    const wrong = total - score;
    const deg = pct * 3.6;

    let emoji, msg;
    if (pct >= 90)      { emoji='ğŸ†'; msg='Ù…Ù…ØªØ§Ø²! Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!'; }
    else if (pct >= 70) { emoji='ğŸŒŸ'; msg='Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹! Ø£Ø­Ø³Ù†Øª!'; }
    else if (pct >= 50) { emoji='ğŸ’ª'; msg='Ø¬ÙŠØ¯! ÙˆØ§ØµÙ„ Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'; }
    else                { emoji='ğŸ“š'; msg='ØªØ­ØªØ§Ø¬ Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙˆØ§Ù„ØªØ¯Ø±ÙŠØ¨'; }

    let grid = '';
    answers.forEach((a,i) => {
        grid += `<div class="s-item ${a.ok?'s-ok':'s-fail'}">${i+1}</div>`;
    });

    document.getElementById('resultsCard').innerHTML = `
        <h2>${emoji} Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
        <div class="donut" style="background:conic-gradient(#7c3aed ${deg}deg, rgba(255,255,255,0.08) ${deg}deg);">
            <div class="donut-inner">
                <div class="donut-pct">${pct}%</div>
                <div class="donut-label">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</div>
            </div>
        </div>
        <div class="result-msg">${msg}</div>
        <div class="stats-row">
            <div class="stat-box stat-ok">
                <div class="stat-num">${score}</div>
                <div class="stat-txt">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø© âœ“</div>
            </div>
            <div class="stat-box stat-fail">
                <div class="stat-num">${wrong}</div>
                <div class="stat-txt">Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© âœ—</div>
            </div>
        </div>
        <div class="summary-title">Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</div>
        <div class="summary-grid">${grid}</div>
        <button class="retry-btn" onclick="startQuiz()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
    `;

    window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>